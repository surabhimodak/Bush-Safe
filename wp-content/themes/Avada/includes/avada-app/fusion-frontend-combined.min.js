var FusionPageBuilder=FusionPageBuilder||{};jQuery,FusionPageBuilder.Panel=Backbone.Model.extend({defaults:{type:"panel"}}),FusionPageBuilder.Tab=Backbone.Model.extend({defaults:{type:"tab"}}),FusionPageBuilder.SidebarView=Backbone.View.extend({template:FusionPageBuilder.template(jQuery("#fusion-builder-sidebar-template").html()),events:{"click .fusion-builder-toggles a":"switchContext","focus .fusion-builder-search":"initSearch","keypress .fusion-builder-search":"checkResults","click .fusion-builder-go-back":"switchInnerContext"},currentSectionTarget:!1,fbeOptionsAdded:!1,initialize:function(){this.toSearch=!1,this.poSearch=!1,this._showResults=_.debounce(_.bind(this.showResults,this),500),this.viewManager=jQuery.extend(!0,{},new FusionPageBuilder.ViewManager),this.panelData={open:!1,width:327,context:"to",dialog:!1},this.setPanelStates(),this.flatToObject=!1,this.flatPoObject=!1,this.searchContext="to",this.$body=jQuery("body"),this.$previewPanel=this.$body.find("#customize-preview"),this.listenTo(FusionEvents,"fusion-to-posts_slideshow_number-changed",this.recreatePoTab),this.listenTo(FusionEvents,"fusion-postMessage-custom_fonts",this.updateCustomFonts),this.listenTo(FusionEvents,"fusion-to-portfolio_equal_heights-changed",this.togglePortfolioEqualHeights),this.listenTo(FusionEvents,"fusion-app-setup",this.setup),this.listenTo(FusionEvents,"fusion-preferences-editing_mode-updated",this.setDialogMode),this.listenTo(FusionEvents,"fusion-preferences-sidebar_position-updated",this.setDialogMode),this.listenTo(FusionEvents,"fusion-preferences-sidebar_overlay-updated",this.setDialogMode)},render:function(){return this.$el.html(this.template(this.panelData)),this.addToPanels(),this.resizableDrag(),this.setPanelStyling(),this.setActiveTab(),this},setup:function(){this.addPoPanels(FusionApp.data.samePage),this.addFBEPanels(),this.setDialogMode(),this.setArchiveMode(),this.setPostTypeLabel(),!1===FusionApp.data.is_fusion_element&&void 0===FusionApp.data.template_category&&this.createEditShortcuts()},setDialogMode:function(){var e="undefined"!=typeof FusionApp&&void 0!==FusionApp.preferencesData&&FusionApp.preferencesData;e&&"dialog"===e.editing_mode?(this.$el.find("#customize-controls").attr("data-dialog",!0),this.updatePanelData("dialog",!0),"eo"===this.panelData.context&&this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-to"]').trigger("click")):(this.$el.find("#customize-controls").attr("data-dialog",!1),this.updatePanelData("dialog",!1)),e&&("right"!==e.sidebar_position||this.$body.hasClass("sidebar-right")?"left"===e.sidebar_position&&this.$body.hasClass("sidebar-right")&&(this.$body.removeClass("sidebar-right"),this.destroyResizable(),this.resizableDrag(),this.setPanelStyling()):(this.$body.addClass("sidebar-right"),this.destroyResizable(),this.resizableDrag(),this.setPanelStyling()),"on"===e.sidebar_overlay?this.$previewPanel.addClass("fusion-overlay-mode"):this.$previewPanel.removeClass("fusion-overlay-mode"))},setPostTypeLabel:function(){var e=this.$el.find(".label.fusion-po-only");"fusion_tb_section"===FusionApp.data.postDetails.post_type&&0<e.length?e.html(e.data("layout")):e.html(e.data("name"))},setArchiveMode:function(){"undefined"!=typeof FusionApp&&FusionApp.data.is_archive?this.$el.find("#customize-controls").attr("data-archive",!0):this.$el.find("#customize-controls").attr("data-archive",!1),"undefined"!=typeof FusionApp&&this.$el.find("#customize-controls").attr("data-editor",FusionApp.builderActive)},createEditShortcuts:function(){var e,i=this,t=i.getFlatToObject(),s=i.getFlatPoObject(),n=jQuery("#fb-preview").contents().find("html"),o=jQuery.extend(!0,i.createShortcutsObject(t),i.createShortcutsObject(s,"po"));_.each(o,function(i,t){(e=n.find(t)).length&&!e.hasClass("fusion-panel-customizable")&&(e.append('<span class="fusion-panel-shortcuts-wrapper"><span class="fusion-panel-shortcuts">'+i.join("")+"</span></span>"),e.addClass("fusion-panel-customizable"),"static"===e.css("position")&&e.addClass("fusion-panel-customizable-needs-positioned"))}),n.on("click",".fusion-panel-shortcut",function(e){var t=jQuery(this);void 0===t.attr("href")&&(e.preventDefault(),i.shortcutClick(t))})},createShortcutsObject:function(e,i){var t,s,n={};return i=void 0!==i?i:"",_.each(e,function(e){"object"==typeof e.edit_shortcut&&(t="string"==typeof e.edit_shortcut.selector?e.edit_shortcut.selector.split(","):e.edit_shortcut.selector,_.each(t,function(t){t=t.trim(),_.each(e.edit_shortcut.shortcuts,function(o){var a,r=o.aria_label||!1,u="",l="",d="",p="",c="",f=jQuery.extend(!0,{},o);if(r){if(void 0!==f&&""!==f.disable_on_template_override&&void 0!==FusionApp.data.template_override&&void 0!==FusionApp.data.template_override[f.disable_on_template_override]&&!1!==FusionApp.data.template_override[f.disable_on_template_override])return;void 0!==f&&""!==f.link_to_template_if_override_active&&void 0!==FusionApp.data.template_override&&void 0!==FusionApp.data.template_override[f.link_to_template_if_override_active]&&!1!==FusionApp.data.template_override[f.link_to_template_if_override_active]&&(FusionApp.data.template_override[f.link_to_template_if_override_active].permalink&&-1!==FusionApp.data.template_override[f.link_to_template_if_override_active].permalink.indexOf("?")?f.link=FusionApp.data.template_override[f.link_to_template_if_override_active].permalink+"&fb-edit=1&target_post_id="+FusionApp.data.postDetails.post_id:f.link=FusionApp.data.template_override[f.link_to_template_if_override_active].permalink+"?fb-edit=1&target_post_id="+FusionApp.data.postDetails.post_id,f.target="_top",f.aria_label=void 0!==fusionBuilderText["edit_"+f.link_to_template_if_override_active+"_layout_section"]?fusionBuilderText["edit_"+f.link_to_template_if_override_active+"_layout_section"]:fusionBuilderText.edit_layout_section,void 0!==f.override_icon&&(l=o.override_icon)),void 0!==f.link?(u=void 0!==f.target?f.target:"_blank",a=void 0!==f.css_class?f.css_class:"",""===l&&(l=void 0!==f.icon?f.icon:"fusiona-pen"),p='<a class="fusion-panel-shortcut '+a+'" href="'+f.link+'" target="'+u+'" aria-label="'+f.aria_label+'"><span class="'+l+'"></span></a>'):(""===l&&(l=void 0!==f.icon?f.icon:"fusiona-cog"),void 0!==f.open_parent&&(d=' data-fusion-option-open-parent="true"'),void 0!==f.callback&&(c=' data-callback="'+f.callback+'"'),s=void 0!==f.context?f.context:i,p='<span class="fusion-panel-shortcut" data-fusion-option="'+e.id+'" aria-label="'+f.aria_label+'" data-context="'+s+'"'+d+c+'><span class="'+l+'"></span></span>'),void 0===n[t]&&(n[t]=[]),void 0!==f.order?n[t][f.order]=p:n[t].push(p)}})}))}),n},shortcutClick:function(e){e.attr("data-callback")&&"function"==typeof FusionApp.callback[e.attr("data-callback")]?FusionApp.callback[e.attr("data-callback")](e):this.openOption(e.data("fusion-option"),e.data("context"),e.data("fusion-option-open-parent"))},openOption:function(e,i,t){var s,n,o,a=this;void 0===i&&void 0!==this.getFlatPoObject()[e]&&"object"==typeof FusionApp.data.postMeta._fusion&&void 0!==FusionApp.data.postMeta._fusion[e]&&""!==FusionApp.data.postMeta._fusion[e]&&(i="po"),s="po"!==(i=void 0!==i&&i?i:"to")?this.getFlatToObject():this.getFlatPoObject(),n=s[e],o="object"==typeof n&&n.tab_id,!0===(t=void 0!==t&&t)&&(o=void 0!==n?n.parent_id:e),i=i.toLowerCase(),this.togglePanelState(i,!0),this.setActiveTab(i),n&&"FBE"===n.location&&this.switchActiveContext("#fusion-builder-sections-to","FBE"),this.$el.find("#tab-"+o).length&&this.$el.find("#tab-"+o).is(":visible")||(this.$el.find(".fusion-sidebar-section:visible #"+o).length?this.$el.find(".fusion-sidebar-section:visible #"+o).trigger("click"):this.$el.find(".fusion-sidebar-section:visible #heading_"+o).length&&(!0!==a.$el.find(".fusion-panels").is(":visible")&&(a.$el.find(".fusion-builder-custom-tab:visible .fusion-builder-go-back").trigger("click"),a.$el.find(".fusion-panels").show()),"true"!==this.$el.find(".fusion-sidebar-section:visible #heading_"+o).attr("aria-expanded")&&this.$el.find(".fusion-sidebar-section:visible #heading_"+o).trigger("click"))),setTimeout(function(){t?a.scrollToElement(a.$el.find(".fusion-sidebar-section:visible #heading_"+o)):a.scrollToElement(a.$el.find('[data-option-id="'+n.id+'"]:visible'))},50)},scrollToElement:function(e,i){var t=this.$el.find(".fusion-sidebar-section:visible .fusion-tabs"),s=this.$el.find(".fusion-builder-toggles").outerHeight()+this.$el.find(".fusion-panel-section-header-wrapper").outerHeight(),n=0;t.is(":visible")||(t=this.$el.find(".fusion-sidebar-section:visible .fusion-panels")),i=void 0===i||i,e.length&&(i?(n=e.position().top+t.scrollTop()-s,t.animate({scrollTop:n},450)):(n=e.position().top+t.scrollTop()-s,t.scrollTop(n)))},getFlatToObject:function(){var e={};return!1!==this.flatToObject?this.flatToObject:(_.each(customizer,function(i,t){_.each(i.fields,function(i,s){"sub-section"===i.type||"accordion"===i.type?_.each(i.fields,function(i,n){i.tab_id=s,i.location="TO",e[n]=i,i.parent_id=t}):(i.tab_id=t,i.location="TO",e[s]=i)})}),FusionApp.data&&FusionApp.data.fusionElementsOptions&&_.each(FusionApp.data.fusionElementsOptions,function(i,t){_.each(i.fields,function(i,s){"sub-section"===i.type||"accordion"===i.type?_.each(i.fields,function(i,t){i.tab_id=s,i.location="FBE",e[t]=i}):(i.tab_id=t,i.location="FBE",e[s]=i)})}),this.flatToObject=e,this.flatToObject)},getFlatPoObject:function(){var e={},i=jQuery.extend(!0,{},FusionApp.data.fusionPageOptions);return!1!==this.flatPoObject?this.flatPoObject:(_.each(i,function(i,t){_.each(i.fields,function(i,s){"sub-section"===i.type||"accordion"===i.type?_.each(i.fields,function(i,t){i.tab_id=s,i.location="po",e[t]=i}):(i.tab_id=t,i.location="po",e[s]=i)})}),this.flatPoObject=e,this.flatPoObject)},initSearch:function(){var e="TO",i={threshold:.3,minMatchCharLength:3,keys:["label"]};"po"===this.panelData.context&&(e="PO"),this.searchContext=e,"TO"===e?this.toSearch=new Fuse(_.values(this.getFlatToObject()),i):this.poSearch=new Fuse(_.values(this.getFlatPoObject()),i)},clearSearch:function(){this.$el.find(".fusion-builder-search").val("")},showToggles:function(){this.$el.find(".fusion-builder-toggles").show()},hideToggles:function(){this.$el.find(".fusion-builder-toggles").hide()},destroyResizable:function(){this.$el.find("#customize-controls").resizable("destroy")},resizableDrag:function(){var e=this,i=this.$el.find("#customize-controls"),t=this.$body.hasClass("sidebar-right")?"w":"e";i.hover(function(){e.$body.addClass("fusion-preview-block")},function(){e.$body.hasClass("fusion-sidebar-resizing")||e.$body.removeClass("fusion-preview-block")}),i.resizable({handles:t,minWidth:327,maxWidth:640,start:function(){e.$body.addClass("fusion-preview-block").addClass("fusion-sidebar-resizing")},resize:function(i,t){var s=327>=t.size.width?327:t.size.width;s=640<s?640:s,e.$body.hasClass("sidebar-right")?e.$previewPanel.css("padding-right",s).css("padding-left",0):e.$previewPanel.css("padding-left",s).css("padding-right",0)},stop:function(t,s){var n=327>=s.size.width?327:s.size.width;n=640<n?640:n,e.$body.hasClass("sidebar-right")&&i.css({left:"auto",right:0}),e.updatePanelData("width",n),e.$body.removeClass("fusion-preview-block").removeClass("fusion-sidebar-resizing")}})},checkResults:function(e){this._showResults(e)},showResults:function(e){var i,t,s=jQuery(e.currentTarget).val(),n=this.panelData.context,o="po"!==n?this.toSearch.search(s):this.poSearch.search(s),a=this.$el.find("#fusion-builder-sections-"+n),r={};_.each(o,function(e){r[e.id]=e}),i={model:new FusionPageBuilder.Tab({fields:r,id:"fusion-builder-results",type:"search",label:fusionBuilderText.search_results,context:this.searchContext})},t=new FusionPageBuilder.TabView(i),this.clearTabs(n),a.find("#tab-fusion-builder-results").remove(),a.find(".fusion-tabs").append(t.render().el).show(),a.find(".fusion-tabs").show(),a.find(".fusion-panels, .fusion-tabs .fusion-builder-custom-tab").hide(),a.find("#tab-fusion-builder-results").show()},addToPanels:function(){var e=this,i=this.$el.find("#fusion-builder-sections-to .fusion-panels");_.each(customizer,function(t){var s,n,o=e.viewManager.generateCid();t.label&&(t.cid=o,t.context="TO",t.innerContext="TO",s=new FusionPageBuilder.Panel(t),n=new FusionPageBuilder.PanelView({model:s}),e.viewManager.addView(o,n),i.append(n.render().el))})},addFBEPanels:function(){var e=this,i=this.$el.find("#fusion-builder-sections-to .fusion-panels");e.fbeOptionsAdded||(_.each(FusionApp.data.fusionElementsOptions,function(t){var s,n,o=e.viewManager.generateCid();t.label&&(t.cid=o,t.context="TO",t.innerContext=void 0!==t.addon&&t.addon?"FBAO":"FBE",s=new FusionPageBuilder.Panel(t),n=new FusionPageBuilder.PanelView({model:s}),e.viewManager.addView(o,n),i.append(n.render().el))}),e.fbeOptionsAdded=!0)},updateLabels:function(){this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-po"] .fusion-po-label').addClass("hidden"),this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-ps"] .fusion-ps-label').addClass("hidden"),"archive"!==FusionApp.data.currentPage?(this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-po"] .fusion-page-options').removeClass("hidden"),this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-ps"] .fusion-page-settings').removeClass("hidden")):(this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-po"] .fusion-taxonomy-options').removeClass("hidden"),this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-ps"] .fusion-category-settings').removeClass("hidden"))},addPoPanels:function(e){var i=this.$el.find("#fusion-builder-sections-po .fusion-panels"),t=this;e&&i.find(".fusion-builder-custom-panel").length||(!e&&i.find(".fusion-builder-custom-panel").length&&(this.$el.find("#tab-fusion-builder-results").is(":visible")?this.$el.find("#tab-fusion-builder-results .fusion-builder-go-back").trigger("click"):(this.$el.find('#fusion-builder-tab .fusion-builder-custom-tab[data-type="PO"]').is(":visible")||this.$el.find('a[href="#fusion-builder-sections-po"].fusion-active').length)&&this.$el.find('a[href="#fusion-builder-sections-po"]').trigger("click"),this.clearPanels("po"),this.clearTabs("po")),_.each(FusionApp.data.fusionPageOptions,function(e){var s,n,o=t.viewManager.generateCid();e.label&&(e.cid=o,e.context="PO",s=new FusionPageBuilder.Panel(e),n=new FusionPageBuilder.PanelView({model:s}),i.append(n.render().el),t.viewManager.addView(o,n))}),jQuery('.fusion-builder-toggles [href="#fusion-builder-sections-po"]').hasClass("fusion-active")&&jQuery('.fusion-builder-toggles [href="#fusion-builder-sections-po"]').click())},clearPanels:function(e){var i,t,s=this;e=void 0===e?"to":e.toLowerCase(),(i=this.$el.find("#fusion-builder-sections-"+e+" .fusion-builder-custom-panel")).length&&i.each(function(){(t=s.viewManager.getView(jQuery(this).data("cid")))&&t.removePanel()})},clearTabs:function(e,i,t){var s,n,o,a=this;e=void 0===e?"to":e.toLowerCase(),s=this.$el.find("#fusion-builder-sections-"+e),n=void 0!==i&&i?s.find(".fusion-builder-custom-tab#"+i):s.find(".fusion-builder-custom-tab"),void 0!==t&&t&&(n=n.find('.fusion-builder-option[data-option-id="'+t+'"]').closest(".fusion-builder-custom-tab")),n.length&&n.each(function(){(o=a.viewManager.getView(jQuery(this).data("cid")))&&o.removeTab()})},clearInactiveTabs:function(e){var i,t,s=this;e=void 0===e?"to":e.toLowerCase(),(i=this.$el.find("#fusion-builder-sections-"+e).find(".fusion-builder-custom-tab:not( :visible )")).length&&i.each(function(){(t=s.viewManager.getView(jQuery(this).data("cid")))&&t.removeTab()})},recreatePanels:function(){this.clearPanels("po"),this.addPoPanels(!0)},refreshTo:function(){var e=this;this.$el.find("#fusion-builder-sections-to").show(),this.$el.find('#fusion-builder-tab .fusion-builder-custom-tab[data-type="TO"]').each(function(){e.viewManager.removeView(jQuery(this).data("cid")),jQuery(this).remove()})},switchContext:function(e){var i=jQuery(e.currentTarget),t=i.attr("href"),s=this.$el.find(t),n=t.replace("#fusion-builder-sections-","");e.preventDefault(),this.$el.find(".fusion-active").removeClass("fusion-active"),this.$el.find(".fusion-sidebar-section").hide(),s.show(),s.is("#fusion-builder-sections-eo")||!s.find(".fusion-tabs").is(":visible")||s.find(".fusion-tabs").find(".fusion-builder-custom-tab:visible").length||s.find(".fusion-panels").is(":visible")||(s.find(".fusion-tabs").hide(),s.find(".fusion-panels").show()),i.addClass("fusion-active"),this.setPanelContext(n)},closeSidebar:function(){this.updatePanelData("open",!1),this.setPanelStyling()},openSidebar:function(){this.updatePanelData("open",!0),this.setPanelStyling()},getPanelWidth:function(){return this.panelData.width},panelIsOpen:function(){return this.panelData.open},togglePanel:function(){this.panelIsOpen()?this.closeSidebar():this.openSidebar()},setPanelContext:function(e){this.$el.find("#customize-controls").attr("data-context",e),this.updatePanelData("context",e)},togglePanelState:function(e,i){var t=void 0===e?"to":e,s=this.panelData.context;i=void 0!==i,this.panelIsOpen()&&void 0!==s&&s&&t!==s?this.setActiveTab(t):i&&this.panelIsOpen()||(this.togglePanel(),this.setPanelStyling(),this.panelIsOpen()&&this.setActiveTab(t))},setPanelStyling:function(){var e=this.getPanelWidth(),i=this.$body.hasClass("sidebar-right")?"right":"left",t=this.$body.hasClass("sidebar-right")?"left":"right",s={width:e};s[i]=0,s[t]="auto",this.panelIsOpen()?(this.$body.addClass("expanded"),this.$previewPanel.css("padding-"+i,e).css("padding-"+t,0),this.$el.find("#customize-controls").css(s)):(this.$body.removeClass("expanded"),this.$previewPanel.css("padding-"+i,0).css("padding-"+t,0),this.$el.find("#customize-controls").css(i,-e).css(t,"auto").css("width",e)),FusionEvents.trigger("fusion-sidebar-toggled",this.panelIsOpen())},setActiveTab:function(e){var i=this.$el,t=void 0!==e&&e;e=void 0===e?this.panelData.context:e.toLowerCase(),t&&this.setPanelContext(e),i.find('.fusion-builder-toggles a[href="#fusion-builder-sections-'+e+'"]').hasClass("fusion-active")||(i.find(".fusion-builder-toggles > .fusion-active").removeClass("fusion-active"),i.find('.fusion-builder-toggles a[href="#fusion-builder-sections-'+e+'"]').trigger("click"))},updatePanelData:function(e,i){this.panelData[e]=i,this.storePanelStates(),"open"!==e&&"width"!==e||setTimeout(function(){FusionEvents.trigger("fusion-frame-size-changed")},500)},setPanelStates:function(){var e;if("undefined"!=typeof Storage&&localStorage.getItem("fusionPanel"))try{"object"==typeof(e=JSON.parse(localStorage.getItem("fusionPanel")))&&(this.panelData={open:void 0!==e.open&&e.open,width:void 0!==e.width?e.width:327,context:void 0!==e.context?e.context:"to",dialog:void 0!==e.dialog&&e.dialog})}catch(e){}},storePanelStates:function(){"undefined"!=typeof Storage&&localStorage.setItem("fusionPanel",JSON.stringify(this.panelData))},fixToValueName:function(e,i,t,s){var n=this.getFlatToObject();if(void 0!==n[e]&&void 0!==n[e].choices&&void 0!==n[e].choices[i]&&"yesno"!==t)return n[e].choices[i];switch("object"==typeof i&&(i=_.isEmpty(s)||void 0===i[s]?_.values(i).join(", "):i[s]),t){case"yesno":1==i?i="Yes":0==i&&(i="No");break;case"showhide":1==i?i="Show":0==i&&(i="Hide");break;case"reverseyesno":i=1==i||1==i?"No":"Yes"}return i},recreatePoTab:function(){var e,i,t,s=fusionSanitize.getOption("posts_slideshow_number"),n={};if(!1!==FusionApp.data.is_singular&&("post"===FusionApp.data.postDetails.post_type||"page"===FusionApp.data.postDetails.post_type||"avada_portfolio"===FusionApp.data.postDetails.post_type)){for(i=FusionApp.data.postDetails.post_type,jQuery.each(FusionApp.data.fusionPageOptions.fusion_page_settings_section.fields,function(e){-1!==e.indexOf("kd_featured-image-")&&delete FusionApp.data.fusionPageOptions.fusion_page_settings_section.fields[e]}),t=2;t<=s;t++)e="kd_featured-image-"+t+"_"+i+"_id",(n=jQuery.extend(!0,{},FusionApp.data.featured_image_default)).id=e,n.label=n.label.replace("$",t),n.partial_refresh[e]=jQuery.extend(!0,{},n.partial_refresh["kd_featured-image-$_#_id"]),delete n.partial_refresh["kd_featured-image-$_#_id"],FusionApp.data.fusionPageOptions.fusion_page_settings_section.fields[e]=jQuery.extend({},n);this.viewManager.removeView(this.$el.find("#tab-fusion_page_settings_section").data("cid")),this.$el.find("#tab-fusion_page_settings_section").remove()}},updateCustomFonts:function(){var e=this,i={action:"avada_custom_fonts_font_faces",fusion_load_nonce:fusionAppConfig.fusion_load_nonce,custom_fonts:FusionApp.settings.custom_fonts};return FusionApp.assets.webfonts?(FusionApp.assets.webfonts.custom=[],_.each(FusionApp.settings.custom_fonts.name,function(e){FusionApp.assets.webfonts.custom.push({family:e,label:e,variants:[]})}),jQuery.post(fusionAppConfig.ajaxurl,i,function(e){jQuery("#fb-preview").contents().find("head").find("#css-custom_fonts").length&&jQuery("#fb-preview").contents().find("head").find("#css-custom_fonts").remove(),jQuery("#fb-preview").contents().find("head").append('<style type="text/css" id="css-custom_fonts">'+e+"</style>")}),this.clearPanels("po"),this):(jQuery.when(FusionApp.assets.getWebFonts()).done(function(){e.updateCustomFonts()}),this)},togglePortfolioEqualHeights:function(){"1"===fusionSanitize.getOption("portfolio_equal_heights")?jQuery("#fb-preview").contents().find(".fusion-portfolio-archive").addClass("fusion-portfolio-equal-heights"):jQuery("#fb-preview").contents().find(".fusion-portfolio-archive").removeClass("fusion-portfolio-equal-heights"),window.frames[0].dispatchEvent(new Event("fusion-element-render-fusion_portfolio"))},switchInnerContext:function(e){var i=jQuery(e.currentTarget),t=i.data("context"),s=i.data("trigger"),n=this.$el.find("a#"+s).closest(".fusion-builder-custom-panel");i.closest(".fusion-sidebar-section").attr("data-context",t),this.scrollToElement(n,!1)},switchActiveContext:function(e,i){this.$el.find(e).attr("data-context",i).scrollTop(0)},renderElementSettings:function(e){this.openSidebarAndShowEOTab(),this.$el.find("#fusion-builder-sections-eo").append(e.render().el),FusionPageBuilderApp.SettingsHelpers.renderDialogMoreOptions(e)},openSidebarAndShowEOTab:function(){var e=this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-eo"]');e.hasClass("fusion-active")||e.trigger("click"),this.panelIsOpen()||this.openSidebar(),this.$el.find("#fusion-builder-sections-eo").scrollTop(0)}});FusionPageBuilder=FusionPageBuilder||{};jQuery,FusionPageBuilder.PanelView=Backbone.View.extend({template:FusionPageBuilder.template(jQuery("#fusion-builder-panel-template").html()),className:"fusion-builder-custom-panel",events:{"click .fusion-panel-link":"showTabs","click .fusion-sub-section-link":"showTabs"},initialize:function(){this.$el.attr("data-id",this.model.get("id")),this.$el.attr("data-cid",this.model.get("cid")),this.$el.attr("data-context",this.model.get("innerContext"))},render:function(){return this.setIcon(),this.$el.html(this.template(this.model.attributes)),this},setIcon:function(){var e=this.model.get("icon");void 0!==this.model.get("alt_icon")&&(e=this.model.get("alt_icon")),void 0!==e&&-1===e.indexOf("fusiona")?delete this.model.attributes.icon:this.model.set("icon",e)},removePanel:function(){FusionApp.sidebarView.viewManager.removeView(this.model.get("cid")),this.remove()},showTabs:function(e){var i,t,s,n,o,a,r=jQuery(e.currentTarget),u=r.closest(".fusion-sidebar-section"),l=FusionApp.sidebarView.viewManager.generateCid(),d=this.model.get("fields"),p=!1;if(e.preventDefault(),FusionApp.data.postMeta._fusion=FusionApp.data.postMeta._fusion||{},r.parent().find("li").length)"true"===r.parent().find("a.fusion-panel-link").attr("aria-expanded")&&(p=!0),u.find(".fusion-builder-custom-panel ul li").hide(),u.find(".fusion-builder-custom-panel ul a.fusion-panel-link").attr("aria-expanded","false"),p?(r.parent().find("li").hide(),r.parent().find("a.fusion-panel-link").attr("aria-expanded","false")):(r.parent().find("li").show(),r.parent().find("a.fusion-panel-link").attr("aria-expanded","true"));else{if(setTimeout(function(){0===(a=u.find(".fusion-panels").filter(":visible")).length&&(a=u.find(".fusion-tabs").filter(":visible")),a.scrollTop(0)},50),r.hasClass("fusion-sub-section-link")?i=d[s=r.attr("id")].fields:(s=this.model.get("id"),i=d),"shortcode_styling"===s||"fusion_builder_elements"===s)return void FusionApp.sidebarView.switchActiveContext("#fusion-builder-sections-to","FBE");if("fusion_builder_addons"===s)return void FusionApp.sidebarView.switchActiveContext("#fusion-builder-sections-to","FBAO");u.find(".fusion-builder-custom-tab#tab-"+s).length?(void 0!==(o=FusionApp.sidebarView.viewManager.getView(u.find(".fusion-builder-custom-tab#tab-"+s).data("cid")))&&o.initialCheckDependencies(),o.showTab()):(t={model:new FusionPageBuilder.Tab({fields:i,id:s,type:void 0!==this.model.get("innerContext")?this.model.get("innerContext").toUpperCase():this.model.get("context").toUpperCase(),cid:l,label:jQuery(e.currentTarget).data("label")})},n=new FusionPageBuilder.TabView(t),FusionApp.sidebarView.viewManager.addView(l,n),u.find(".fusion-tabs").append(n.render().el)),u.find(".fusion-tabs").show(),u.find(".fusion-panels").hide(),u.find(".fusion-builder-custom-tab:not( #tab-"+s+")").hide()}}}),jQuery,window.avadaPanelIFrame={fields:{},fieldOutputDependencies:{},applyCallback:function(e,i,t){return t=t||!1,_.isFunction(FusionApp.callback[i])?FusionApp.callback[i](e,t):_.isFunction(window[i])?window[i](e,t):_.isFunction(fusionSanitize[i])?fusionSanitize[i](e,t):_.isFunction(FusionPageBuilder.Callback.prototype[i])?FusionPageBuilder.Callback.prototype[i](e,t):e},applyRefreshCallbacks:function(e,i){var t=this,s=!0,n=t.getValueClone(i);return void 0!==e&&_.each(e,function(e){if(void 0===e.js_callback)return!1;e.js_callback[1]=_.isUndefined(e.js_callback[1])?"":e.js_callback[1],t.applyCallback(n,e.js_callback[0],e.js_callback[1])||(s=!1)}),s},partialRefresh:function(e,i,t,s){var n,o=FusionApp.getAjaxData("fusion_app_partial_refresh");_.each(i,function(e,t){var s=!1;e.skip_for_template&&(_.each(e.skip_for_template,function(e){FusionApp.data.template_override[e]&&(s=!0)}),s&&delete i[t])}),_.isEmpty(i)||(void 0!==i&&(_.each(i,function(e){(n=jQuery("#fb-preview").contents().find("body").find(e.selector)).length?n.append('<div id="fusion-loader"><span class="fusion-slider-loading"></span></div>'):(n=jQuery("#fb-preview").contents().find("head").find(e.selector)).length&&jQuery("body").append('<div id="fusion-loader"><span class="fusion-slider-loading"></span></div>')}),jQuery('li[data-option-id="'+e+'"]').addClass("partial-refresh-active")),o.partials=i,jQuery.ajax({type:"POST",url:fusionAppConfig.ajaxurl,dataType:"json",data:o,success:function(t){_.each(t,function(t,o){i[o].aria_label;var a="string"==typeof i[o].success_trigger_event?i[o].success_trigger_event.split(" "):i[o].success_trigger_event;t=FusionApp.removeScripts(t,s),n=jQuery("#fb-preview").contents().find("html").find(i[o].selector),void 0!==t?(t.length||(t=""),i[o].after?n.after(t):i[o].container_inclusive?n.replaceWith(t):n.html(t),jQuery("#fusion-loader").remove()):(n.html(""),jQuery("#fusion-loader").remove()),jQuery('li[data-option-id="'+e+'"]').removeClass("partial-refresh-active"),i[o].success_trigger_event&&_.each(a,function(e){window.dispatchEvent(new Event(e)),window.frames[0].window.dispatchEvent(new Event(e)),"function"==typeof window[e]&&window[e](),"function"==typeof window.frames[0].window[e]&&window.frames[0].window[e]()}),n.removeClass("fusion-panel-customizable"),FusionApp.sidebarView.createEditShortcuts()}),FusionApp.injectScripts(s),setTimeout(function(){jQuery("#fb-preview")[0].contentWindow.jQuery("body").trigger("fusion-partial-"+e)},100)}}))},getValueClone:function(e){return e},getPoToValue:function(e,i,t){var s=this.getGlobalMapKey(e);return void 0===t&&(t=!1),s?this.getPoToValueFromGlobalKey(s,i,t):null},getGlobalMapKey:function(e){var i=e;return _.each(["is_home","is_tag","is_category","is_author","is_date","is_singular_post"],function(t){if(FusionApp.data[t]&&_.find(fusionOptionNetworkNames,function(s,n){if(s[t]&&e===s[t])return i=n,!0}),i)return!0}),i},getPoToValueFromGlobalKey:function(e,i,t){var s,n=null,o=!1;if(FusionApp.settings[e]&&(n=FusionApp.settings[e]),-1!==e.indexOf("[")&&((s=e.split("["))[0]=s[0].replace("]",""),s[1]=s[1].replace("]",""),FusionApp.settings[s[0]]&&void 0!==FusionApp.settings[s[0]][s[1]]&&(n=FusionApp.settings[s[0]][s[1]])),void 0!==t&&t)return n;switch(fusionOptionNetworkNames[e]&&-1!==FusionApp.data.postDetails.post_id.toString().indexOf("-archive")&&fusionOptionNetworkNames[e].archive&&("object"==typeof fusionOptionNetworkNames[e].archive&&fusionOptionNetworkNames[e].archive[0]?FusionApp.settings[fusionOptionNetworkNames[e].archive[0]]&&(n=FusionApp.settings[fusionOptionNetworkNames[e].archive[0]],i&&"undefined"!==n[i]&&(n=n[i])):FusionApp.settings[fusionOptionNetworkNames[e].archive]&&(n=FusionApp.settings[fusionOptionNetworkNames[e].archive],i&&"undefined"!==n[i]&&(n=n[i]))),e){case"header_bg_repeat":case"header_bg_full":o=FusionApp.data.postMeta._fusion.header_bg_image&&""===FusionApp.data.postMeta._fusion.header_bg_image.url;break;case"bg_repeat":case"bg_full":o=FusionApp.data.postMeta._fusion.bg_image&&""===FusionApp.data.postMeta._fusion.bg_image.url;break;case"content_bg_repeat":case"content_bg_full":o=FusionApp.data.postMeta._fusion.content_bg_image&&""===FusionApp.data.postMeta._fusion.content_bg_image.url}return o||(void 0!==FusionApp.data.postMeta._fusion&&void 0!==FusionApp.data.postMeta._fusion[e]&&""!==FusionApp.data.postMeta._fusion[e]&&"default"!==FusionApp.data.postMeta._fusion[e]?n=FusionApp.data.postMeta._fusion[e]:void 0!==FusionApp.data.postMeta[e]&&""!==FusionApp.data.postMeta[e]&&"default"!==FusionApp.data.postMeta[e]&&(n=FusionApp.data.postMeta[e])),"page_title_bar"!==e&&"blog_show_page_title_bar"!==e&&"blog_page_title_bar"!==e||(n="no"===(n="yes_without_bar"===(n="yes"===(n=n.toLowerCase())?"bar_and_content":n)?"content_only":n)?"hide":n),n},addHoverElements:function(e){var i="";return"string"==typeof e&&e.indexOf(",")&&(e=e.split(",")),"string"==typeof e&&-1!==e.indexOf(":hover")?(i=e.replace(":hover",".hover")+",")+e:("object"==typeof e&&(e=_.toArray(e),_.each(e,function(t){-1!==t.indexOf(":hover")&&(i=t.replace(":hover",".hover"),e.push(i))})),e)},generateCSS:function(e,i,t,s,n,o){var a,r,u,l,d,p,c="TO"===s||"FBE"===s?FusionApp.settings:FusionApp.data.postMeta._fusion,f=this;c=c||{},a=(c="PS"===s?FusionApp.data.postDetails:c)[e],u=r=a,s="FBE"===s?"TO":s,f.needsPreviewUpdate(e,s)&&(l='<style type="text/css" id="css-'+e+'">',i&&_.each(i,function(i){if("PS"!==s&&(r=f.getPoToValue(e,i.choice)),i=_.defaults(i,{element:"",property:"",units:"",prefix:"",suffix:"",js_callback:!1,callback:!1,value_pattern:"$",pattern_replace:!1,media_query:!1,function:"style"}),i=jQuery.extend(!0,{},i),!_.isObject(u)||_.isUndefined(i.choice)||_.isUndefined(u[i.choice])||(r=u[i.choice]),"PO"!==s||_.isObject(u)||_.isUndefined(i.choice)||(r=c[i.choice]),n&&(i.element=f.addHoverElements(i.element)),_.isObject(i.element)&&(i.element=jQuery.map(i.element,function(e){return[e]}),i.element=i.element.join(",")),"attr"===i.function)f.elementAttrs(i,r);else if("html"===i.function)f.elementHtmlContent(i,r);else{if(FusionApp.sidebarView.flatToObject[e]&&FusionApp.sidebarView.flatToObject[e].type)switch(FusionApp.sidebarView.flatToObject[e].type){case"media":r=r&&r.url?r.url:"",i.property&&"background-image"===i.property&&""===r&&(r="none")}_.isObject(r)?(d=jQuery.extend(!0,{},i),_.each(r,function(e,t){!i.element||"margin"!==i.property&&"padding"!==i.property||"top"!==t&&"bottom"!==t&&"left"!==t&&"right"!==t?i.property&&""!==i.property||(d.property=t):d.property=i.property+"-"+t,l+=f.getSingleCSS(e,d)})):l+=f.getSingleCSS(r,i)}}),t&&_.each(t,function(i){var t=void 0!==i.po&&!1===i.po?f.getPoToValue(e,i.choice,!0):f.getPoToValue(e,i.choice,!1),s=":root";!_.isObject(t)||_.isUndefined(i.choice)||_.isUndefined(t[i.choice])||(t=t[i.choice]),i.value_pattern=void 0===i.value_pattern?"$":i.value_pattern,t=t||"",i.choice&&t&&"object"==typeof t[i.choice]&&(t=t[i.choice]),i.exclude&&("string"==typeof i.exclude&&(i.exclude=[i.exclude]),_.each(i.exclude,function(e){t===e&&(t="")})),t=i.value_pattern.replace(/\$/g,t),void 0!==i.callback&&(t=f.applyCallback(t,i.callback[0],i.callback[1])),"string"==typeof i.element&&(s=i.element),l+=s+"{"+i.name+":"+t+";}"}),l+="</style>",jQuery("#fb-preview").contents().find("head").find("#css-"+e).length&&jQuery("#fb-preview").contents().find("head").find("#css-"+e).remove(),jQuery("#fb-preview").contents().find("head").append(l),p=["h1_typography","h2_typography","h3_typography","h4_typography","h5_typography","h6_typography"],_.contains(p,e)&&this.updateResponsiveTypography(e,a),"TO"===s||"FBE"===s?FusionApp.storedToCSS[e]=l:FusionApp.storedPoCSS[e]=l)},elementHtmlContent:function(e,i){!0!==this.getExcludeBool(i,e)&&(i=this.getCssValue(i,e),jQuery("#fb-preview").contents().find(e.element).html(i))},elementAttrs:function(e,i){var t,s,n=this.getExcludeBool(i,e);if(!_.isUndefined(e.attr)&&!_.isEmpty(e.attr)&&!0!==n&&(i=this.getCssValue(i,e),e.toLowerCase&&(i=i.toLowerCase()),""!==i)){if(s=jQuery("#fb-preview").contents().find(e.element),t=s.attr(e.attr),_.isUndefined(t)&&(t=""),!_.isUndefined(e.remove_attrs)&&!_.isEmpty(e.remove_attrs)&&""!==t)return _.each(e.remove_attrs,function(i){"class"===e.attr&&s.removeClass(i),t=(t=(t=t.split(i+",").join("")).split(i+" ").join("")).split(i).join("")}),t+=""!==t?" ":"",t+=i,void("class"===e.attr?s.addClass(t):s.attr(e.attr,t));s.attr(e.attr,i)}},liveUpdateCustomCSS:function(e){var i=void 0!==e?e:"";jQuery("#fb-preview").contents().find("#fusion-builder-custom-css").length&&jQuery("#fb-preview").contents().find("#fusion-builder-custom-css").html(i)},liveUpdatePageCustomCSS:function(e){jQuery("#fb-preview").contents().find("#fusion-builder-page-css").length?jQuery("#fb-preview").contents().find("#fusion-builder-page-css").html(e):(e='<style type="text/css" id="fusion-builder-page-css">'+e+"</style>",jQuery("#fb-preview").contents().find("#fusion-builder-custom-css").length?jQuery("#fb-preview").contents().find("#fusion-builder-custom-css").after(e):jQuery("#fb-preview").contents().find("head").append(e))},updateResponsiveTypography:function(e,i){var t=e.split("_")[0];"function"==typeof jQuery("#fb-preview")[0].contentWindow.fusionCalculateResponsiveTypeValues&&document.querySelector("#fb-preview").contentWindow.document.body.dispatchEvent(new CustomEvent("fusion-typography",{detail:{heading:t,values:i}}))},getSingleCSS:function(e,i){var t="";return!0===this.getExcludeBool(e,i)?"":(e=this.getCssValue(e,i),e=i.prefix+e+i.units+i.suffix,i.media_query&&(0===i.media_query.indexOf("fusion-")&&(i.media_query=fusionReturnMediaQuery(i.media_query)),t+=i.media_query+"{"),t+=i.element+"{"+i.property+":"+e+";}",i.media_query&&(t+="}"),!e||_.isEmpty(e)?"":t)},getExcludeBool:function(e,i){var t=!1;return _.isUndefined(i.exclude)||(e===i.exclude&&(t=!0),_.isArray(i.exclude)&&_.each(i.exclude,function(i){i==e&&(t=!0),!t&&_.isEmpty(i)&&_.isEmpty(e)&&(t=!0),t||_.isUndefined(e.url)||i!==e.url||(t=!0)})),t},getCssValue:function(e,i){return void 0!==i.value_pattern&&!1!==i.value_pattern&&(e=i.value_pattern.replace(/\$/g,e),i.pattern_replace&&_.each(i.pattern_replace,function(i,t){var s=i.replace(originalOptionName+"[","").replace("]",""),n=i;s!==i&&(n=FusionApp.settings[s]),e=e.replace(t,n).replace(t,n)})),i.js_callback?(i.js_callback[1]=_.isUndefined(i.js_callback[1])?"":i.js_callback[1],e=this.applyCallback(e,i.js_callback[0],i.js_callback[1])):i.callback&&(i.callback[1]=_.isUndefined(i.callback[1])?"":i.callback[1],e=this.applyCallback(e,i.callback[0],i.callback[1])),i.property&&"background-image"===i.property&&"string"==typeof e&&-1===e.indexOf("url(")&&-1!==e.indexOf("/")&&-1!==e.indexOf(".")&&-1===e.indexOf("-gradient(")&&(e="url("+e+")"),e},needsPreviewUpdate:function(e,i){return"scheme_type"===e||"post_title"===e||"name"===e||"TO"!==i||this.validateChangeContext(e,i)[1]===i},validateChangeContext:function(e,i){var t=e,s=!1,n={TAXO:"term",PO:"post",TO:"theme"};return i=void 0===n[i]?"TO":i,_.each(fusionOptionNetworkNames,function(o,a){!1===s&&(a===e||void 0!==o[n[i]]&&o[n[i]]===e)&&FusionApp.data.postMeta._fusion[t]&&""!==FusionApp.data.postMeta._fusion[t]&&"default"!==FusionApp.data.postMeta._fusion[t]&&(s=[t,i])}),!1===s?[t,"TO"]:s},populateFieldOutputDependencies:function(){var e,i=this;i.fieldOutputDependencies&&_.isEmpty(i.fieldOutputDependencies)&&(FusionApp.sidebarView.flatToObject&&!_.isEmpty(FusionApp.sidebarView.flatToObject)||FusionApp.sidebarView.getFlatToObject(),_.each(FusionApp.sidebarView.flatToObject,function(t){t.output&&_.each(t.output,function(s){s.js_callback&&s.js_callback&&s.js_callback[0]&&"conditional_return_value"===s.js_callback[0]&&_.each(s.js_callback[1].conditions,function(s){-1!==s[0].indexOf(originalOptionName+"[")&&(e=s[0].replace(originalOptionName+"[","").replace("]",""),i.fieldOutputDependencies[e]||(i.fieldOutputDependencies[e]=[]),-1===i.fieldOutputDependencies[e].indexOf(t.id)&&i.fieldOutputDependencies[e].push(t.id))}),s.pattern_replace&&_.each(s.pattern_replace,function(e,s){var n=e.replace(originalOptionName+"[","").replace("]","");i.fieldOutputDependencies[n]||(i.fieldOutputDependencies[n]=[]),-1===i.fieldOutputDependencies[n].indexOf(t.id)&&i.fieldOutputDependencies[n].push(t.id)})})}))}};FusionPageBuilder=FusionPageBuilder||{};jQuery,FusionPageBuilder.TabView=Backbone.View.extend({template:FusionPageBuilder.template(jQuery("#fusion-builder-tab-template").html()),events:{"click .fusion-builder-go-back":"showSections","change input":"optionChange","keyup input:not(.fusion-slider-input)":"optionChange","change select":"optionChange","keyup textarea":"optionChange","change textarea":"optionChange","click .upload-image-remove":"removeImage","click .option-preview-toggle":"previewToggle","click .fusion-panel-description":"showHideDescription","click .fusion-panel-shortcut":"defaultPreview","click .fusion-quick-option":"quickOption"},className:"fusion-builder-custom-tab",initialize:function(){this.$el.attr("id","tab-"+this.model.get("id")),this.$el.attr("data-cid",this.model.get("cid")),this.$el.attr("data-type",this.model.get("type")),this._updatePreview=_.debounce(_.bind(this.updatePreview,this),1e3),this._validateOption=_.debounce(_.bind(this.validateOption,this),1e3),this.options=this.model.get("fields"),this.type=this.model.get("type"),this.initialCheckDependencies(),this.activeStates={},this.$targetEl=!1,this._tempStateRemove=_.debounce(_.bind(this.tempStateRemove,this),3e3),this.hasSlug=!0,"import_export"===this.model.get("id")&&this.listenTo(FusionEvents,"fusion-to-changed",this.updateExportCode),"import_export_po"===this.model.get("id")&&(this.listenTo(FusionEvents,"fusion-po-changed",this.updateExportCode),this.listenTo(FusionEvents,"fusion-ps-changed",this.updateExportCode))},render:function(){return this.$el.html(this.template(this.model.attributes)),this.initOptions(),FusionApp.sidebarView.$el.find(".fusion-sidebar-section:visible").scrollTop(0),this},quickOption:function(e){var i=jQuery(e.target);e.preventDefault(),FusionApp.sidebarView.openOption(i.data("fusion-option"))},showTab:function(){this.$el.show(),FusionApp.sidebarView.$el.find(".fusion-sidebar-section:visible").scrollTop(0)},initialCheckDependencies:function(){var e=this;setTimeout(function(){"TO"!==e.type&&"PO"!==e.type&&"FBE"!==e.type||(e.dependencies=new FusionPageBuilder.Dependencies(e.options,e))},10)},optionChange:function(e){this.validateOption(e)&&(this.needsDebounce(e)?this._updatePreview(e):this.updatePreview(e))},removeTab:function(){FusionApp.sidebarView.viewManager.removeView(this.model.get("cid")),this.remove()},showHideDescription:function(e){var i=jQuery(e.currentTarget),t=i.closest(".fusion-builder-option").find(".fusion-tooltip-description"),s=t.text();i.closest(".fusion-builder-option").find(".description").first().slideToggle(250),t.text(s===fusionBuilderText.fusion_panel_desciption_show?fusionBuilderText.fusion_panel_desciption_hide:fusionBuilderText.fusion_panel_desciption_show),i.toggleClass("active")},defaultPreview:function(e){var i=jQuery(e.currentTarget);e&&e.preventDefault(),FusionApp.sidebarView&&(jQuery(".fusion-builder-toggles a").first().trigger("click"),FusionApp.sidebarView.openOption(i.data("fusion-option"),"to"))},initOptions:function(e){var i=void 0!==e&&e.length?e:this.$el;this.optionColorpicker(i),this.optionRadioButtonSet(i),this.optionDimension(i),this.optionSelect(i),this.optionAjaxSelect(i),this.optionMultiSelect(),this.optionRange(i),this.optionUpload(i),this.optionMultiUpload(i),this.optionCodeBlock(i),this.optionTypography(i),this.optionSwitch(i),this.optionImport(i),this.optionExport(i),this.optionSortable(i),this.optionColorPalette(i),this.optionRaw(i),this.optionLinkSelector(i),this.optionHubSpotMap(i),void 0===e&&this.optionRepeater(this.type)},needsDebounce:function(e){var i=jQuery(e.currentTarget).closest(".fusion-builder-option"),t=i.data("option-id"),s=this.model.get("fields"),n=s[t];return void 0===n&&i.parent().hasClass("repeater-fields")&&(n=s[t=i.parent().closest(".fusion-builder-option").data("option-id")]),!(void 0!==n&&(void 0!==n.output||void 0!==n.css_vars||void 0!==n.transport&&"postMessage"===n.transport)||void 0!==n&&"select"===n.type)},showSections:function(e){var i,t=this.$el.closest(".fusion-sidebar-section");e&&e.preventDefault(),"search"===this.model.get("type")?("PO"===(i=this.model.get("context"))||"PS"===i?(FusionApp.sidebarView.setActiveTab("po",i),jQuery("#fusion-builder-sections-po .fusion-panels").show()):(FusionApp.sidebarView.setActiveTab("to",i),jQuery("#fusion-builder-sections-to .fusion-panels").show()),FusionApp.sidebarView.clearSearch()):"TO"===this.model.get("type")?jQuery("#fusion-builder-sections-to .fusion-panels").show():"FBE"===this.model.get("type")?(FusionApp.sidebarView.switchActiveContext("#fusion-builder-sections-to","FBE"),t.find(".fusion-tabs").hide(),t.find(".fusion-panels").show()):"FBAO"===this.model.get("type")?(FusionApp.sidebarView.switchActiveContext("#fusion-builder-sections-to","FBAO"),t.find(".fusion-tabs").hide(),t.find(".fusion-panels").show()):jQuery("#fusion-builder-sections-po .fusion-panels").show(),this.$el.closest(".fusion-tabs").hide(),"fusion-builder-results"===this.model.get("id")?this.remove():FusionApp.sidebarView.scrollToElement(FusionApp.sidebarView.$el.find("a#"+this.model.get("id")).closest(".fusion-builder-custom-panel"),!1)},getValue:function(e,i,t){var s;return"checkbox"===e.attr("type")&&e.hasClass("fusion-select-option")?(t=[],_.each(e.parent().find(".fusion-select-option:checked"),function(e){t.push(jQuery(e).val())}),t):"checkbox"===e.attr("type")?e.is(":checked")?"1":"0":(e.hasClass("fusion-url-only-input")&&(s=e.closest(".fusion-upload-area").find(".fusion-image-as-object")).length&&s.val(JSON.stringify({url:t})).trigger("change"),jQuery(i.currentTarget).parents(".fusion-builder-option.code").length?this.codeEditorOption[jQuery(i.currentTarget).parents(".fusion-builder-option.code").attr("data-index")].getValue():(e.hasClass("fusion-with-default")&&(t=(t=e.parents(".fusion-builder-option").find(".fusion-hidden-value").val())||""),e.hasClass("fusion-repeater-value")&&""!==t&&(t=JSON.parse(t)),t))},needsUpdate:function(e,i,t,s){return!(i===s[t]||e.hasClass("fusion-dont-update")||e.hasClass("fusion-import-file-input")||"demo_import"===t||(e.parents(".fusion-builder-option.repeater").length&&!e.hasClass("fusion-repeater-value")?(e.hasClass("fusion-image-as-object")&&(i=void 0===i||""===i?{url:""}:jQuery.parseJSON(i)),this.setRepeaterValue(e.parents(".fusion-builder-option.repeater").find(".fusion-repeater-value"),t,e.parents(".repeater-row").index(),i),1):""===i&&_.isUndefined(s[t])&&_.isUndefined(s[t])||e&&e.hasClass("color-picker")&&!e.hasClass("fusion-color-created")||e.hasClass("fusion-color-palette-color-picker")||_.isObject(s[t])&&(e.parents(".fusion-builder-dimension").length||e.parents(".fusion-builder-typography").length)&&i===s[t][e.attr("name")]))},saveChange:function(e,i,t,s,n){var o;if((_.isObject(s[t])||_.isUndefined(s[t]))&&(e.parents(".fusion-builder-dimension").length||e.parents(".fusion-builder-typography").length||e.parents(".fusion-builder-repeater").length))if(_.isUndefined(s[t])&&(s[t]={}),"variant"===e.attr("name")){if(s[t]["font-weight"]===this.getFontWeightFromVariant(i)&&s[t]["font-style"]===this.getFontStyleFromVariant(i))return;s[t].variant=i,s[t]["font-weight"]=this.getFontWeightFromVariant(i),s[t]["font-style"]=this.getFontStyleFromVariant(i)}else-1!==e.attr("name").indexOf("[")?((o=e.attr("name").split("["))[0]=o[0].replace("]",""),o[1]=o[1].replace("]",""),s[o[0]]=s[o[0]]||{},s[o[0]][o[1]]=i):s[t][e.attr("name")]=i;else e.hasClass("fusion-image-as-object")?(i=jQuery.parseJSON(i),s[t]=i):s[t]=i;void 0!==FusionApp.contentChange&&("TO"===n||"FBE"===n?(FusionEvents.trigger("fusion-to-changed"),FusionEvents.trigger("fusion-to-"+t+"-changed"),FusionApp.contentChange("global","theme-option"),window.dispatchEvent(new Event("fusion-to-"+t+"-changed"))):"PO"===n||"TAXO"===n?(FusionEvents.trigger("fusion-po-changed"),FusionEvents.trigger("fusion-po-"+t+"-changed"),FusionApp.contentChange("page","page-option"),window.dispatchEvent(new Event("fusion-po-"+t+"-changed"))):"PS"===n&&(FusionEvents.trigger("fusion-ps-changed"),FusionEvents.trigger("fusion-"+t+"-changed"),FusionApp.contentChange("page","page-setting"),window.dispatchEvent(new Event("fusion-page-"+t+"-changed"))))},getSaveId:function(e,i,t){var s=this.model.get("fields");if("PO"===t){if(e.hasClass("fusion-po-dimension"))return e.attr("id");if(!_.isUndefined(s[i])&&_.isUndefined(s[i].not_pyre)&&FusionApp.data.singular)return i}return i},getSaveLocation:function(e,i){switch(e){case"FBE":case"TO":return FusionApp.settings;case"PS":return FusionApp.data.postDetails;case"PO":case"TAXO":return"_wp_page_template"===i||"_thumbnail_id"===i||"_fusion_builder_custom_css"===i?FusionApp.data.postMeta:(FusionApp.data.postMeta._fusion=FusionApp.data.postMeta._fusion||{},FusionApp.data.postMeta._fusion)}},updatePreview:function(e,i,t){var s=this,n=jQuery(e.currentTarget),o=n.parents(".fusion-builder-option"),a=o.data("option-id"),r=n.val(),u=o.data("type"),l=this.getSaveLocation(u,a),d=o.find(".option-preview-toggle").length,p=!1,c=this.getSaveId(n,a,u),f=this.model.get("fields");r=this.getValue(n,e,r),(!0===i||this.needsUpdate(n,r,c,l))&&(this.saveChange(n,r,c,l,u),"TO"!==u&&"FBE"!==u&&"PO"!==u||(FusionApp.createMapObjects(),"object"==typeof l[c]?(this.updateSettingsToParams(a+"["+n.attr("name")+"]",r),this.updateSettingsToExtras(a+"["+n.attr("name")+"]",r),this.updateSettingsToParams(a,l[c]),this.updateSettingsToExtras(a,l[c]),"TO"!==u&&"FBE"!==u||this.updateSettingsToPo(a,l[c])):(this.updateSettingsToParams(a,r),this.updateSettingsToExtras(a,r),"TO"!==u&&"FBE"!==u||this.updateSettingsToPo(a,r)),FusionEvents.trigger("fusion-preview-update",a,r)),"object"==typeof f[a].events&&_.each(f[a].events,function(e){FusionEvents.trigger(e,a,r)}),!1!==this.checkUpdateCallbacks(f[a])&&("post_title"===a&&this.maybeUpdateSlug(r),void 0!==jQuery(e.currentTarget).attr("class")&&"fusion-multiselect-input"===jQuery(e.currentTarget).attr("class")||f[a]&&(f[a].id&&"color_palette"===f[a].id||(f[a].id&&"custom_css"===f[a].id?avadaPanelIFrame.liveUpdateCustomCSS(r):f[a].id&&"_fusion_builder_custom_css"===f[a].id?avadaPanelIFrame.liveUpdatePageCustomCSS(r):!f[a].id||"visibility_small"!==f[a].id&&"visibility_medium"!==f[a].id?((f[a].output||f[a].css_vars)&&!1!==avadaPanelIFrame.applyRefreshCallbacks(f[a].css_vars,r)&&(d&&this.triggerTemporaryState(o),avadaPanelIFrame.generateCSS(c,f[a].output,f[a].css_vars,u,d,f[a].type),_.isUndefined(f[a].output_fields_trigger_change)||(t||(t=[a]),_.each(f[a].output_fields_trigger_change,function(e){-1===t.indexOf(e)&&(t.push(e),s.updatePreview({currentTarget:jQuery('.fusion-builder-option[data-option-id="'+e+'"] input')},!0,t))})),avadaPanelIFrame.populateFieldOutputDependencies(),avadaPanelIFrame.fieldOutputDependencies[a]&&(t||(t=[a]),_.each(avadaPanelIFrame.fieldOutputDependencies[a],function(e){-1===t.indexOf(e)&&(t.push(e),s.updatePreview({currentTarget:jQuery('.fusion-builder-option[data-option-id="'+e+'"] input')},!0,t))})),p=!0),_.isUndefined(f[a].partial_refresh)||_.isEmpty(f[a].partial_refresh)||!1!==avadaPanelIFrame.applyRefreshCallbacks(f[a].partial_refresh,r)&&(avadaPanelIFrame.partialRefresh(c,f[a].partial_refresh,r,this.model.get("cid")),p=!0),_.isUndefined(f[a].transport)||"postMessage"!==f[a].transport||(p=!0,FusionEvents.trigger("fusion-postMessage-"+a),window.dispatchEvent(new Event("fusion-postMessage-"+a))),p&&(_.isUndefined(f[a].transport)||"refresh"!==f[a].transport)||!1!==avadaPanelIFrame.applyRefreshCallbacks(f[a].full_refresh,r)&&(o.addClass("full-refresh-active"),FusionApp.fullRefresh(),FusionEvents.once("fusion-app-setup",function(){o.removeClass("full-refresh-active")}))):jQuery("#fusion-parent-window-css-vars").html(":root{--small_screen_width:"+FusionApp.settings.visibility_small+"px;}:root{--medium_screen_width:"+FusionApp.settings.visibility_medium+"px;}")))))},maybeUpdateSlug:function(e){var i,t,s,n,o=this.$el.find("#post_name");if(o.length&&(o.val()&&""!==o.val()||(this.hasSlug=!1),e&&""!==e&&!this.hasSlug)){for(e=e.replace(/^\s+|\s+$/g,"").toLowerCase(),t="aaaaeeeeiiiioooouuuunc------",s=0,n=(i="àáäâèéëêìíïîòóöôùúüûñç·/_,:;").length;s<n;s++)e=e.replace(new RegExp(i.charAt(s),"g"),t.charAt(s));e=e.replace(".","-").replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),o.val(e).trigger("change")}},cloneValue:function(e){return e},updateSettingsToParams:function(e,i,t){var s,n,o,a,r=this,u=r.cloneValue(i);t=void 0!==t&&t,_.isUndefined(FusionApp.settingsToParams[e])||_.each(FusionApp.settingsToParams[e],function(l){_.isUndefined(fusionAllElements[l.element])||(l.callback&&(o={id:e,type:r.model.get("type")},i=avadaPanelIFrame.applyCallback(u,l.callback,o)),fusionAllElements[l.element].defaults[l.param]=i,_.isUndefined(fusionAllElements[l.element].params[l.param])||_.isUndefined(fusionAllElements[l.element].params[l.param].default)||("colorpickeralpha"!==fusionAllElements[l.element].params[l.param].type&&"color"!==fusionAllElements[l.element].params[l.param].type&&"range"!==fusionAllElements[l.element].params[l.param].type||(fusionAllElements[l.element].params[l.param].default=i,1===(s=jQuery("."+l.element+' [data-option-id="'+l.param+'"]')).length&&FusionEvents.trigger("fusion-default-changed-"+s.closest(".fusion-builder-module-settings").attr("data-element-cid"),l.param,i)),jQuery('.description [data-fusion-option="'+e+'"]').length&&(a=jQuery('.description [data-fusion-option="'+e+'"]').closest(".fusion-builder-option").attr("class").split(" ").pop(),n=FusionApp.sidebarView.fixToValueName(e,i,a),jQuery('.description [data-fusion-option="'+e+'"]').html(n))),FusionEvents.trigger("fusion-param-default-update-"+l.param,i),t||(FusionEvents.trigger("fusion-global-update-"+l.element,l.param,i),r.triggerActiveStates()))})},updateSettingsToExtras:function(e,i,t){var s=this,n=s.cloneValue(i);"object"!=typeof FusionApp.settingsToExtras||_.isUndefined(FusionApp.settingsToExtras[e])||(t=void 0!==t&&t,_.each(FusionApp.settingsToExtras[e],function(e){_.isUndefined(fusionAllElements[e.element])||(e.callback&&(i=avadaPanelIFrame.applyCallback(n,e.callback,!1)),fusionAllElements[e.element].extras[e.param]=i,t||(FusionEvents.trigger("fusion-extra-update-"+e.element,e.param,i),s.triggerActiveStates()))}))},updateSettingsToPo:function(e,i){var t,s=this.cloneValue(i);_.isUndefined(FusionApp.settingsToPo[e])||_.isUndefined(FusionApp.data.fusionPageOptions)||_.isEmpty(FusionApp.data.fusionPageOptions)||_.each(FusionApp.settingsToPo[e],function(e){_.isUndefined(FusionApp.data.fusionPageOptions[e.tab])||_.isUndefined(FusionApp.data.fusionPageOptions[e.tab].fields[e.option])||(t=FusionApp.data.fusionPageOptions[e.tab].fields[e.option],e.callback&&(i=avadaPanelIFrame.applyCallback(s,e.callback,!1)),FusionApp.sidebarView.clearTabs("po",!1,e.option),"color-alpha"!==t.type&&"color"!==t.type&&"slider"!==t.type&&"sortable"!==t.type||(t.default=i))})},validateOption:function(e){var i=jQuery(e.currentTarget),t=i.val(),s=i.parents(".fusion-builder-option"),n=s.data("option-id"),o=!0,a="";return"checkbox"===i.attr("type")&&(t=i.is(":checked")?"1":"0"),s.hasClass("spacing")||s.hasClass("dimension")?(o=FusionApp.validate.cssValue(t),a=fusionBuilderTabL10n.invalidCssValue):s.hasClass("color")?(o=FusionApp.validate.validateColor(t,"hex"),a=fusionBuilderTabL10n.invalidColor):s.hasClass("color-alpha")?(o=FusionApp.validate.validateColor(t),a=fusionBuilderTabL10n.invalidColor):s.hasClass("typography")&&("font-size"===i.attr("name")?(o=FusionApp.validate.cssValue(t),a=fusionBuilderTabL10n.invalidCssValueVar.replace("%s",i.attr("name"))):"line-height"!==i.attr("name")&&"letter-spacing"!==i.attr("name")||(o=FusionApp.validate.cssValue(t,!0),a=fusionBuilderTabL10n.invalidCssValueVar.replace("%s",i.attr("name")))),!1===o?(FusionApp.validate.message("add",n,i,a),!1):(FusionApp.validate.message("remove",n,i),!0)},checkUpdateCallbacks:function(e){var i=!0,t=[],s=!1;return e&&e.id&&e.update_callback&&_.each(e.update_callback,function(e){var i;if(e.operator)switch(i=e.where?FusionApp.data[e.where]:FusionApp.data,e.operator){case"===":i[e.condition]!==e.value&&t.push(!1);break;case"!==":i[e.condition]===e.value&&t.push(!1)}else _.each(e,function(e){if(e.operator)switch(i=e.where?FusionApp.data[e.where]:FusionApp.data,e.operator){case"===":i[e.condition]===e.value&&(s=!0);break;case"!==":i[e.condition]!==e.value&&(s=!0)}}),t.push(s)}),_.each(t,function(e){e||(i=!1)}),i}}),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionTypographyField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionCodeBlock),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionColorPicker),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionDimensionField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionOptionUpload),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.radioButtonSet),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionRangeField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionRepeaterField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionSelectField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionAjaxSelect),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionMultiSelect),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionSwitchField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionImportUpload),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionExport),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionSortable),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionColorPalette),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionRawField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionLinkSelector),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionHubSpotMap),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.fusionActiveStates);FusionPageBuilder=FusionPageBuilder||{};jQuery,_.extend(FusionPageBuilder.Callback.prototype,{fusion_get_alpha:function(e){return jQuery.Color(e).alpha()},createSocialNetworks:function(){var e=[];return"0"!=FusionApp.settings.sharing_facebook&&e.push("facebook"),"0"!=FusionApp.settings.sharing_twitter&&e.push("twitter"),"0"!=FusionApp.settings.sharing_linkedin&&e.push("linkedin"),"0"!=FusionApp.settings.sharing_reddit&&e.push("reddit"),"0"!=FusionApp.settings.sharing_whatsapp&&e.push("whatsapp"),"0"!=FusionApp.settings.sharing_tumblr&&e.push("tumblr"),"0"!=FusionApp.settings.sharing_pinterest&&e.push("pinterest"),"0"!=FusionApp.settings.sharing_vk&&e.push("vk"),"0"!=FusionApp.settings.sharing_email&&e.push("mail"),e.join("|")},toYes:function(e){return 1==e||!0===e?"yes":"no"},toLowerCase:function(e){return e.toLowerCase()},urlFromObject:function(e){return"object"==typeof e&&void 0!==e.url?e.url:""},portfolioPaginationFormat:function(e){return e.toLowerCase().replace(/ /g,"").replace(/\_/g,"-").replace("scroll","").replace(/-\s*$/,"")},noPortfolioOnPage:function(){return!(0<jQuery("#fb-preview").contents().find(".fusion-portfolio-layout-grid, .fusion-portfolio-carousel").length)},isPaginationOnPage:function(){return 0!==jQuery("#fb-preview").contents().find(".pagination").length},isRolloverOnPage:function(){return 0!==jQuery("#fb-preview").contents().find(".fusion-image-wrapper").length},isMasonryOnPage:function(){return 0!==jQuery("#fb-preview").contents().find(".fusion-blog-layout-masonry, .fusion-portfolio-masonry, .fusion-gallery-layout-masonry").length},updateGridSeps:function(e){var i="",t=jQuery("#fb-preview").contents().find("div.fusion-content-sep");return _.each(e.split("|"),function(e){i+=" sep-"+e}),t.removeClass("sep-single sep-solid sep-double sep-dashed sep-dotted sep-shadow"),t.addClass(i),!0},timeLineColorCallback:function(){return!(0<jQuery("#fb-preview").contents().find(".fusion-blog-layout-masonry, .twitter-timeline-rendered").length)},fusionEditGlobalSidebar:function(e){var i="pages_sidebar";FusionApp.data.is_singular_post?i="posts_sidebar":FusionApp.data.is_portfolio_single?i="portfolio_sidebar":FusionApp.data.is_portfolio_archive?i="portfolio_archive_sidebar":FusionApp.data.is_search?i="search_sidebar":FusionApp.data.is_product?i="woo_sidebar":FusionApp.data.is_woo_archive?i="woocommerce_archive_sidebar":FusionApp.data.is_singular_ec?i="ec_sidebar":FusionApp.data.is_bbpress||FusionApp.data.is_buddypress?i="ppbress_sidebar":(FusionApp.data.is_home||FusionApp.data.is_archive&&!FusionApp.data.is_search)&&(i="blog_archive_sidebar"),-1<e.data("fusion-option").indexOf("_2")&&(i+="_2"),FusionApp.sidebarView.openOption(i,"to",e.data("fusion-option-open-parent"))},fusionEditFeaturedImage:function(e){FusionApp.sidebarView.openOption("_thumbnail_id","po",e.data("fusion-option-open-parent"))}});